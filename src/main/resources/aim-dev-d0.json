{
  "Resources": {
    "TalendRole": {
      "Type": "AWS::IAM::Role",
      "Properties": {
        "Path": {
          "Fn::Join": [
            "",
            [
              "/aim/",
              {
                "Ref": "StackName"
              },
              "/"
            ]
          ]
        },
        "AssumeRolePolicyDocument": {
          "Statement": {
            "Action": [
              "sts:AssumeRole"
            ],
            "Effect": "Allow",
            "Principal": {
              "Service": [
                "ec2.amazonaws.com"
              ]
            }
          }
        }
      }
    },
    "HdpNetAclInSsh": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "100",
        "Protocol": "6",
        "PortRange": {
          "To": "22",
          "From": "22"
        },
        "Egress": "false",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "UE1HDPLA01DNS": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "DNS",
            "Zone"
          ]
        },
        "TTL": "60",
        "Type": "A",
        "Name": {
          "Fn::Join": [
            ".",
            [
              {
                "Fn::Join": [
                  "",
                  [
                    "UE1-HDP-LA01",
                    {
                      "Ref": "StackName"
                    }
                  ]
                ]
              },
              {
                "Fn::FindInMap": [
                  {
                    "Ref": "StackName"
                  },
                  "DNS",
                  "Suffix"
                ]
              }
            ]
          ]
        },
        "ResourceRecords": [
          {
            "Fn::GetAtt": [
              "UE1HDPLA01",
              "PrivateIp"
            ]
          }
        ]
      }
    },
    "HdpNetAclOut389": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "111",
        "Protocol": "17",
        "PortRange": {
          "To": "389",
          "From": "389"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "UE1HDPLA03DNS": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "DNS",
            "Zone"
          ]
        },
        "TTL": "60",
        "Type": "A",
        "Name": {
          "Fn::Join": [
            ".",
            [
              {
                "Fn::Join": [
                  "",
                  [
                    "UE1-HDP-LA03",
                    {
                      "Ref": "StackName"
                    }
                  ]
                ]
              },
              {
                "Fn::FindInMap": [
                  {
                    "Ref": "StackName"
                  },
                  "DNS",
                  "Suffix"
                ]
              }
            ]
          ]
        },
        "ResourceRecords": [
          {
            "Fn::GetAtt": [
              "UE1HDPLA03",
              "PrivateIp"
            ]
          }
        ]
      }
    },
    "HdpNetAclInDnsUdp": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "106",
        "Protocol": "17",
        "PortRange": {
          "To": "53",
          "From": "53"
        },
        "Egress": "false",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "HdpNetAclInTcpHighInternal": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "101",
        "Protocol": "6",
        "PortRange": {
          "To": "65535",
          "From": "1024"
        },
        "Egress": "false",
        "RuleAction": "Allow",
        "CidrBlock": "0.0.0.0/0"
      }
    },
    "RSCluster": {
      "DeletionPolicy": "Snapshot",
      "Type": "AWS::Redshift::Cluster",
      "Properties": {
        "ClusterParameterGroupName": {
          "Ref": "RSParamGrp"
        },
        "PubliclyAccessible": "false",
        "PreferredMaintenanceWindow": "Sat:05:00-Sat:06:00",
        "MasterUsername": "edw",
        "Encrypted": "true",
        "ClusterType": "multi-node",
        "MasterUserPassword": {
          "Ref": "RSPassword"
        },
        "VpcSecurityGroupIds": [
          {
            "Ref": "RSSecGrp"
          }
        ],
        "ClusterSubnetGroupName": {
          "Ref": "RSNetGrp"
        },
        "AutomatedSnapshotRetentionPeriod": "30",
        "NodeType": "dc1.large",
        "DBName": "edw",
        "NumberOfNodes": "3"
      }
    },
    "TestAimHdpAclNetAssociation": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "TestAimHdpNet"
        },
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        }
      }
    },
    "UE1HDPLA04DNS": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "DNS",
            "Zone"
          ]
        },
        "TTL": "60",
        "Type": "A",
        "Name": {
          "Fn::Join": [
            ".",
            [
              {
                "Fn::Join": [
                  "",
                  [
                    "UE1-HDP-LA04",
                    {
                      "Ref": "StackName"
                    }
                  ]
                ]
              },
              {
                "Fn::FindInMap": [
                  {
                    "Ref": "StackName"
                  },
                  "DNS",
                  "Suffix"
                ]
              }
            ]
          ]
        },
        "ResourceRecords": [
          {
            "Fn::GetAtt": [
              "UE1HDPLA04",
              "PrivateIp"
            ]
          }
        ]
      }
    },
    "UE1HDPLA02DNS": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "DNS",
            "Zone"
          ]
        },
        "TTL": "60",
        "Type": "A",
        "Name": {
          "Fn::Join": [
            ".",
            [
              {
                "Fn::Join": [
                  "",
                  [
                    "UE1-HDP-LA02",
                    {
                      "Ref": "StackName"
                    }
                  ]
                ]
              },
              {
                "Fn::FindInMap": [
                  {
                    "Ref": "StackName"
                  },
                  "DNS",
                  "Suffix"
                ]
              }
            ]
          ]
        },
        "ResourceRecords": [
          {
            "Fn::GetAtt": [
              "UE1HDPLA02",
              "PrivateIp"
            ]
          }
        ]
      }
    },
    "TalendProfile": {
      "Type": "AWS::IAM::InstanceProfile",
      "Properties": {
        "Path": {
          "Fn::Join": [
            "",
            [
              "/aim/",
              {
                "Ref": "StackName"
              },
              "/"
            ]
          ]
        },
        "Roles": [
          {
            "Ref": "TalendRole"
          }
        ]
      }
    },
    "HdpNetAclOutTcpHigh": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "103",
        "Protocol": "6",
        "PortRange": {
          "To": "65535",
          "From": "1024"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "0.0.0.0/0"
      }
    },
    "HdpNetAclOut25Tcp": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "115",
        "Protocol": "6",
        "PortRange": {
          "To": "25",
          "From": "25"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "MdmSecGrp": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "SecurityGroupIngress": [
          {
            "ToPort": "22",
            "FromPort": "22",
            "IpProtocol": "tcp",
            "CidrIp": "10.11.250.0/23"
          },
          {
            "ToPort": "22",
            "FromPort": "22",
            "IpProtocol": "tcp",
            "CidrIp": "10.101.16.0/21"
          },
          {
            "ToPort": "22",
            "FromPort": "22",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.0/24"
          },
          {
            "ToPort": "22",
            "FromPort": "22",
            "IpProtocol": "tcp",
            "CidrIp": "10.10.10.0/23"
          },
          {
            "ToPort": "1099",
            "FromPort": "1098",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.74/32"
          },
          {
            "ToPort": "4445",
            "FromPort": "3873",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.74/32"
          },
          {
            "ToPort": "8443",
            "FromPort": "8009",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.74/32"
          },
          {
            "ToPort": "1099",
            "FromPort": "1098",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.96/32"
          },
          {
            "ToPort": "4445",
            "FromPort": "3873",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.96/32"
          },
          {
            "ToPort": "8443",
            "FromPort": "8009",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.96/32"
          },
          {
            "ToPort": "1099",
            "FromPort": "1098",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.38/32"
          },
          {
            "ToPort": "4445",
            "FromPort": "3873",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.38/32"
          },
          {
            "ToPort": "8443",
            "FromPort": "8009",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.38/32"
          },
          {
            "ToPort": "1099",
            "FromPort": "1098",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.64/32"
          },
          {
            "ToPort": "4445",
            "FromPort": "3873",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.64/32"
          },
          {
            "ToPort": "8443",
            "FromPort": "8009",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.64/32"
          },
          {
            "ToPort": "1099",
            "FromPort": "1098",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.45/32"
          },
          {
            "ToPort": "4445",
            "FromPort": "3873",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.45/32"
          },
          {
            "ToPort": "8443",
            "FromPort": "8009",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.45/32"
          },
          {
            "ToPort": "1099",
            "FromPort": "1098",
            "IpProtocol": "tcp",
            "CidrIp": "10.10.10.27/32"
          },
          {
            "ToPort": "4445",
            "FromPort": "3873",
            "IpProtocol": "tcp",
            "CidrIp": "10.10.10.27/32"
          },
          {
            "ToPort": "8443",
            "FromPort": "8009",
            "IpProtocol": "tcp",
            "CidrIp": "10.10.10.27/32"
          },
          {
            "ToPort": "1099",
            "FromPort": "1098",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.103/32"
          },
          {
            "ToPort": "4445",
            "FromPort": "3873",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.103/32"
          },
          {
            "ToPort": "8443",
            "FromPort": "8009",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.103/32"
          }
        ],
        "VpcId": "vpc-b7c9a9d2",
        "Tags": [
          {
            "Value": "MdmSecGrp",
            "Key": "Name"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          }
        ],
        "GroupDescription": "Mdm Sec Grp",
        "SecurityGroupEgress": [
          {
            "ToPort": "80",
            "FromPort": "80",
            "IpProtocol": "tcp",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "ToPort": "123",
            "FromPort": "123",
            "IpProtocol": "udp",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "ToPort": "443",
            "FromPort": "443",
            "IpProtocol": "tcp",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "ToPort": "1433",
            "FromPort": "1433",
            "IpProtocol": "tcp",
            "CidrIp": "10.2.0.0/16"
          },
          {
            "ToPort": "3306",
            "FromPort": "3306",
            "IpProtocol": "tcp",
            "CidrIp": "10.2.0.0/16"
          }
        ]
      }
    },
    "UE1TALLA02": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#cloud-config\nhostname: ",
                {
                  "Fn::Join": [
                    "",
                    [
                      "UE1-TAL-LA02",
                      {
                        "Ref": "StackName"
                      }
                    ]
                  ]
                },
                "\n",
                "fqdn: ",
                {
                  "Fn::Join": [
                    ".",
                    [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "UE1-TAL-LA02",
                            {
                              "Ref": "StackName"
                            }
                          ]
                        ]
                      },
                      {
                        "Fn::FindInMap": [
                          {
                            "Ref": "StackName"
                          },
                          "DNS",
                          "Suffix"
                        ]
                      }
                    ]
                  ]
                },
                "\n",
                "runcmd:\n",
                "- [ touch, /etc/aim_tal_app ]"
              ]
            ]
          }
        },
        "SourceDestCheck": "true",
        "Tags": [
          {
            "Value": {
              "Fn::Join": [
                "",
                [
                  "UE1-TAL-LA02",
                  {
                    "Ref": "StackName"
                  }
                ]
              ]
            },
            "Key": "Name"
          },
          {
            "Value": "parttime_aim",
            "Key": "workload"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          },
          {
            "Value": "AIM",
            "Key": "Group"
          },
          {
            "Value": "Mike D.",
            "Key": "Owner"
          },
          {
            "Value": {
              "Fn::FindInMap": [
                {
                  "Ref": "StackName"
                },
                "Extras",
                "Tag"
              ]
            },
            "Key": "Env"
          },
          {
            "Value": "Talend",
            "Key": "Application"
          },
          {
            "Value": "Tac",
            "Key": "Service"
          }
        ],
        "ImageId": "ami-6905f002",
        "KeyName": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "Key",
            "KeyName"
          ]
        },
        "InstanceType": "m3.xlarge",
        "NetworkInterfaces": [
          {
            "SubnetId": {
              "Ref": "TestAimTalendNet"
            },
            "DeviceIndex": "0",
            "GroupSet": [
              {
                "Ref": "TestAimHdpSecGrp"
              }
            ],
            "DeleteOnTermination": "true",
            "AssociatePublicIpAddress": "false"
          }
        ]
      }
    },
    "HdpNetAclOutUdpKdc": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "106",
        "Protocol": "17",
        "PortRange": {
          "To": "88",
          "From": "88"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "IntegrationPolicy": {
      "Type": "AWS::IAM::Policy",
      "Properties": {
        "PolicyName": {
          "Fn::Join": [
            "-",
            [
              {
                "Ref": "StackName"
              },
              "talend"
            ]
          ]
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:ListBucket"
              ],
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:aws:s3:::",
                      "accolade-aim-",
                      {
                        "Ref": "StackName"
                      },
                      "-edw"
                    ]
                  ]
                }
              ],
              "Effect": "Allow"
            },
            {
              "Action": [
                "s3:GetObject",
                "s3:PutObject",
                "s3:DeleteObject"
              ],
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:aws:s3:::",
                      "accolade-aim-",
                      {
                        "Ref": "StackName"
                      },
                      "-edw/*"
                    ]
                  ]
                }
              ],
              "Effect": "Allow"
            },
            {
              "Action": [
                "sts:AssumeRole"
              ],
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "TalendRole",
                    "Arn"
                  ]
                }
              ],
              "Effect": "Allow"
            }
          ]
        },
        "Roles": [
          {
            "Ref": "TalendRole"
          }
        ]
      }
    },
    "AimHdpNetAcl": {
      "Type": "AWS::EC2::NetworkAcl",
      "Properties": {
        "VpcId": "vpc-b7c9a9d2",
        "Tags": [
          {
            "Value": "AimHdpNetAcl",
            "Key": "Name"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          }
        ]
      }
    },
    "TestAimTalendAclNetAssociation": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "TestAimTalendNet"
        },
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        }
      }
    },
    "TestAimTalendRtNetAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "TestAimTalendNet"
        },
        "RouteTableId": "rtb-052f5f60"
      }
    },
    "HdpNetAclOut389Tcp": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "113",
        "Protocol": "6",
        "PortRange": {
          "To": "389",
          "From": "389"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "UE1HDPLA01": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#cloud-config\nhostname: ",
                {
                  "Fn::Join": [
                    "",
                    [
                      "UE1-HDP-LA01",
                      {
                        "Ref": "StackName"
                      }
                    ]
                  ]
                },
                "\n",
                "fqdn: ",
                {
                  "Fn::Join": [
                    ".",
                    [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "UE1-HDP-LA01",
                            {
                              "Ref": "StackName"
                            }
                          ]
                        ]
                      },
                      {
                        "Fn::FindInMap": [
                          {
                            "Ref": "StackName"
                          },
                          "DNS",
                          "Suffix"
                        ]
                      }
                    ]
                  ]
                },
                "\n",
                "runcmd:\n",
                "- [ touch, /etc/aim_ambari ]"
              ]
            ]
          }
        },
        "SourceDestCheck": "true",
        "Tags": [
          {
            "Value": {
              "Fn::Join": [
                "",
                [
                  "UE1-HDP-LA01",
                  {
                    "Ref": "StackName"
                  }
                ]
              ]
            },
            "Key": "Name"
          },
          {
            "Value": "parttime_aim",
            "Key": "workload"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          },
          {
            "Value": "AIM",
            "Key": "Group"
          },
          {
            "Value": "Mike D.",
            "Key": "Owner"
          },
          {
            "Value": {
              "Fn::FindInMap": [
                {
                  "Ref": "StackName"
                },
                "Extras",
                "Tag"
              ]
            },
            "Key": "Env"
          },
          {
            "Value": "Hadoop",
            "Key": "Application"
          },
          {
            "Value": "NameNode",
            "Key": "Service"
          }
        ],
        "ImageId": "ami-4bc23020",
        "KeyName": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "Key",
            "KeyName"
          ]
        },
        "InstanceType": "m3.large",
        "NetworkInterfaces": [
          {
            "SubnetId": {
              "Ref": "TestAimHdpNet"
            },
            "DeviceIndex": "0",
            "GroupSet": [
              {
                "Ref": "TestAimHdpSecGrp"
              }
            ],
            "DeleteOnTermination": "true",
            "AssociatePublicIpAddress": "false"
          }
        ]
      }
    },
    "HdpNetAclOutUdpHigh": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "104",
        "Protocol": "17",
        "PortRange": {
          "To": "65535",
          "From": "1024"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.2.0.0/16"
      }
    },
    "TestAimHdpNet": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": "vpc-b7c9a9d2",
        "CidrBlock": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "HdpNet",
            "CIDR"
          ]
        },
        "Tags": [
          {
            "Value": "TestAimHdpNet",
            "Key": "Name"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          }
        ]
      }
    },
    "RSParamGrp": {
      "Type": "AWS::Redshift::ClusterParameterGroup",
      "Properties": {
        "ParameterGroupFamily": "redshift-1.0",
        "Description": "AIM RS Param Group",
        "Parameters": [
          {
            "ParameterName": "require_ssl",
            "ParameterValue": "true"
          },
          {
            "ParameterName": "enable_user_activity_logging",
            "ParameterValue": "true"
          }
        ]
      }
    },
    "HdpNetAclOutTcpKdc": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "105",
        "Protocol": "6",
        "PortRange": {
          "To": "88",
          "From": "88"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "TestAimRSRtNetAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "RSSubnet"
        },
        "RouteTableId": "rtb-052f5f60"
      }
    },
    "UE1TALLA01DNS": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "DNS",
            "Zone"
          ]
        },
        "TTL": "60",
        "Type": "A",
        "Name": {
          "Fn::Join": [
            ".",
            [
              {
                "Fn::Join": [
                  "",
                  [
                    "UE1-TAL-LA01",
                    {
                      "Ref": "StackName"
                    }
                  ]
                ]
              },
              {
                "Fn::FindInMap": [
                  {
                    "Ref": "StackName"
                  },
                  "DNS",
                  "Suffix"
                ]
              }
            ]
          ]
        },
        "ResourceRecords": [
          {
            "Fn::GetAtt": [
              "UE1TALLA01",
              "PrivateIp"
            ]
          }
        ]
      }
    },
    "RSSubnet": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": "vpc-b7c9a9d2",
        "AvailabilityZone": "us-east-1a",
        "CidrBlock": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "RS",
            "CIDR"
          ]
        },
        "Tags": [
          {
            "Value": "RSSubnet",
            "Key": "Name"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          }
        ]
      }
    },
    "RSSecGrp": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "SecurityGroupIngress": [
          {
            "ToPort": "5439",
            "FromPort": "5439",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          }
        ],
        "VpcId": "vpc-b7c9a9d2",
        "GroupDescription": "Test VPC AIM RS Sec Grp",
        "Tags": [
          {
            "Value": "RSSecGrp",
            "Key": "Name"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          }
        ]
      }
    },
    "HdpNetAclInTcpHighVpn": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "104",
        "Protocol": "6",
        "PortRange": {
          "To": "65535",
          "From": "1024"
        },
        "Egress": "false",
        "RuleAction": "Allow",
        "CidrBlock": "0.0.0.0/0"
      }
    },
    "UE1HDPLA04": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#cloud-config\nhostname: ",
                {
                  "Fn::Join": [
                    "",
                    [
                      "UE1-HDP-LA04",
                      {
                        "Ref": "StackName"
                      }
                    ]
                  ]
                },
                "\n",
                "fqdn: ",
                {
                  "Fn::Join": [
                    ".",
                    [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "UE1-HDP-LA04",
                            {
                              "Ref": "StackName"
                            }
                          ]
                        ]
                      },
                      {
                        "Fn::FindInMap": [
                          {
                            "Ref": "StackName"
                          },
                          "DNS",
                          "Suffix"
                        ]
                      }
                    ]
                  ]
                },
                "\n",
                "runcmd:\n",
                "- [ touch, /etc/aim_talend_data ]"
              ]
            ]
          }
        },
        "SourceDestCheck": "true",
        "Tags": [
          {
            "Value": {
              "Fn::Join": [
                "",
                [
                  "UE1-HDP-LA04",
                  {
                    "Ref": "StackName"
                  }
                ]
              ]
            },
            "Key": "Name"
          },
          {
            "Value": "parttime_aim",
            "Key": "workload"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          },
          {
            "Value": "AIM",
            "Key": "Group"
          },
          {
            "Value": "Mike D.",
            "Key": "Owner"
          },
          {
            "Value": {
              "Fn::FindInMap": [
                {
                  "Ref": "StackName"
                },
                "Extras",
                "Tag"
              ]
            },
            "Key": "Env"
          },
          {
            "Value": "Hadoop",
            "Key": "Application"
          },
          {
            "Value": "DataNode",
            "Key": "Service"
          }
        ],
        "ImageId": "ami-42b9232a",
        "KeyName": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "Key",
            "KeyName"
          ]
        },
        "InstanceType": "m3.large",
        "NetworkInterfaces": [
          {
            "SubnetId": {
              "Ref": "TestAimHdpNet"
            },
            "DeviceIndex": "0",
            "GroupSet": [
              {
                "Ref": "TestAimHdpSecGrp"
              }
            ],
            "DeleteOnTermination": "true",
            "AssociatePublicIpAddress": "false"
          }
        ]
      }
    },
    "UE1TALLA02DNS": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "DNS",
            "Zone"
          ]
        },
        "TTL": "60",
        "Type": "A",
        "Name": {
          "Fn::Join": [
            ".",
            [
              {
                "Fn::Join": [
                  "",
                  [
                    "UE1-TAL-LA02",
                    {
                      "Ref": "StackName"
                    }
                  ]
                ]
              },
              {
                "Fn::FindInMap": [
                  {
                    "Ref": "StackName"
                  },
                  "DNS",
                  "Suffix"
                ]
              }
            ]
          ]
        },
        "ResourceRecords": [
          {
            "Fn::GetAtt": [
              "UE1TALLA02",
              "PrivateIp"
            ]
          }
        ]
      }
    },
    "UE1HDPLA02": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#cloud-config\nhostname: ",
                {
                  "Fn::Join": [
                    "",
                    [
                      "UE1-HDP-LA02",
                      {
                        "Ref": "StackName"
                      }
                    ]
                  ]
                },
                "\n",
                "fqdn: ",
                {
                  "Fn::Join": [
                    ".",
                    [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "UE1-HDP-LA02",
                            {
                              "Ref": "StackName"
                            }
                          ]
                        ]
                      },
                      {
                        "Fn::FindInMap": [
                          {
                            "Ref": "StackName"
                          },
                          "DNS",
                          "Suffix"
                        ]
                      }
                    ]
                  ]
                },
                "\n",
                "runcmd:\n",
                "- [ touch, /etc/aim_talend_data ]"
              ]
            ]
          }
        },
        "SourceDestCheck": "true",
        "Tags": [
          {
            "Value": {
              "Fn::Join": [
                "",
                [
                  "UE1-HDP-LA02",
                  {
                    "Ref": "StackName"
                  }
                ]
              ]
            },
            "Key": "Name"
          },
          {
            "Value": "parttime_aim",
            "Key": "workload"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          },
          {
            "Value": "AIM",
            "Key": "Group"
          },
          {
            "Value": "Mike D.",
            "Key": "Owner"
          },
          {
            "Value": {
              "Fn::FindInMap": [
                {
                  "Ref": "StackName"
                },
                "Extras",
                "Tag"
              ]
            },
            "Key": "Env"
          },
          {
            "Value": "Hadoop",
            "Key": "Application"
          },
          {
            "Value": "DataNode",
            "Key": "Service"
          }
        ],
        "ImageId": "ami-42b9232a",
        "KeyName": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "Key",
            "KeyName"
          ]
        },
        "InstanceType": "m3.large",
        "NetworkInterfaces": [
          {
            "SubnetId": {
              "Ref": "TestAimHdpNet"
            },
            "DeviceIndex": "0",
            "GroupSet": [
              {
                "Ref": "TestAimHdpSecGrp"
              }
            ],
            "DeleteOnTermination": "true",
            "AssociatePublicIpAddress": "false"
          }
        ]
      }
    },
    "UE1HDPLA03": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#cloud-config\nhostname: ",
                {
                  "Fn::Join": [
                    "",
                    [
                      "UE1-HDP-LA03",
                      {
                        "Ref": "StackName"
                      }
                    ]
                  ]
                },
                "\n",
                "fqdn: ",
                {
                  "Fn::Join": [
                    ".",
                    [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "UE1-HDP-LA03",
                            {
                              "Ref": "StackName"
                            }
                          ]
                        ]
                      },
                      {
                        "Fn::FindInMap": [
                          {
                            "Ref": "StackName"
                          },
                          "DNS",
                          "Suffix"
                        ]
                      }
                    ]
                  ]
                },
                "\n",
                "runcmd:\n",
                "- [ touch, /etc/aim_talend_data ]"
              ]
            ]
          }
        },
        "SourceDestCheck": "true",
        "Tags": [
          {
            "Value": {
              "Fn::Join": [
                "",
                [
                  "UE1-HDP-LA03",
                  {
                    "Ref": "StackName"
                  }
                ]
              ]
            },
            "Key": "Name"
          },
          {
            "Value": "parttime_aim",
            "Key": "workload"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          },
          {
            "Value": "AIM",
            "Key": "Group"
          },
          {
            "Value": "Mike D.",
            "Key": "Owner"
          },
          {
            "Value": {
              "Fn::FindInMap": [
                {
                  "Ref": "StackName"
                },
                "Extras",
                "Tag"
              ]
            },
            "Key": "Env"
          },
          {
            "Value": "Hadoop",
            "Key": "Application"
          },
          {
            "Value": "DataNode",
            "Key": "Service"
          }
        ],
        "ImageId": "ami-42b9232a",
        "KeyName": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "Key",
            "KeyName"
          ]
        },
        "InstanceType": "m3.large",
        "NetworkInterfaces": [
          {
            "SubnetId": {
              "Ref": "TestAimHdpNet"
            },
            "DeviceIndex": "0",
            "GroupSet": [
              {
                "Ref": "TestAimHdpSecGrp"
              }
            ],
            "DeleteOnTermination": "true",
            "AssociatePublicIpAddress": "false"
          }
        ]
      }
    },
    "UE1EDWLA01": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#cloud-config\nhostname: ",
                {
                  "Fn::Join": [
                    "",
                    [
                      "UE1-EDW-LA01",
                      {
                        "Ref": "StackName"
                      }
                    ]
                  ]
                },
                "\n",
                "fqdn: ",
                {
                  "Fn::Join": [
                    ".",
                    [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "UE1-EDW-LA01",
                            {
                              "Ref": "StackName"
                            }
                          ]
                        ]
                      },
                      {
                        "Fn::FindInMap": [
                          {
                            "Ref": "StackName"
                          },
                          "DNS",
                          "Suffix"
                        ]
                      }
                    ]
                  ]
                },
                "\n",
                "write_files:\n",
                " - path: /root/.pgpass\n",
                "   permissions: '0600'\n",
                "   content: |\n",
                {
                  "Fn::Join": [
                    "",
                    [
                      "     edw.",
                      {
                        "Ref": "StackName"
                      },
                      ".aim.local:edw:edw:",
                      {
                        "Ref": "RSPassword"
                      }
                    ]
                  ]
                },
                "\n"
              ]
            ]
          }
        },
        "SourceDestCheck": "true",
        "Tags": [
          {
            "Value": {
              "Fn::Join": [
                "",
                [
                  "UE1-EDW-LA01",
                  {
                    "Ref": "StackName"
                  }
                ]
              ]
            },
            "Key": "Name"
          },
          {
            "Value": "parttime_aim",
            "Key": "workload"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          },
          {
            "Value": "AIM",
            "Key": "Group"
          },
          {
            "Value": "Mike D.",
            "Key": "Owner"
          },
          {
            "Value": {
              "Fn::FindInMap": [
                {
                  "Ref": "StackName"
                },
                "Extras",
                "Tag"
              ]
            },
            "Key": "Env"
          },
          {
            "Value": "Edw",
            "Key": "Application"
          },
          {
            "Value": "JobsServer",
            "Key": "Service"
          }
        ],
        "ImageId": "ami-6905f002",
        "KeyName": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "Key",
            "KeyName"
          ]
        },
        "IamInstanceProfile": {
          "Ref": "TalendProfile"
        },
        "InstanceType": "m3.large",
        "NetworkInterfaces": [
          {
            "SubnetId": {
              "Ref": "TestAimTalendNet"
            },
            "DeviceIndex": "0",
            "GroupSet": [
              {
                "Ref": "TestAimHdpSecGrp"
              }
            ],
            "DeleteOnTermination": "true",
            "AssociatePublicIpAddress": "false"
          }
        ]
      }
    },
    "HdpNetAclInWebVpn": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "105",
        "Protocol": "6",
        "PortRange": {
          "To": "80",
          "From": "80"
        },
        "Egress": "false",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "TestAimTalendNet": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "VpcId": "vpc-b7c9a9d2",
        "CidrBlock": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "TalendNet",
            "CIDR"
          ]
        },
        "Tags": [
          {
            "Value": "TestAimTalendNet",
            "Key": "Name"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          }
        ]
      }
    },
    "UE1MDMLA01": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#cloud-config\nhostname: ",
                {
                  "Fn::Join": [
                    "",
                    [
                      "UE1-MDM-LA01",
                      {
                        "Ref": "StackName"
                      }
                    ]
                  ]
                },
                "\n",
                "fqdn: ",
                {
                  "Fn::Join": [
                    ".",
                    [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "UE1-MDM-LA01",
                            {
                              "Ref": "StackName"
                            }
                          ]
                        ]
                      },
                      {
                        "Fn::FindInMap": [
                          {
                            "Ref": "StackName"
                          },
                          "DNS",
                          "Suffix"
                        ]
                      }
                    ]
                  ]
                },
                "\n",
                "runcmd:\n",
                "- [ touch, /etc/aim_tal_mdm ]"
              ]
            ]
          }
        },
        "SourceDestCheck": "true",
        "Tags": [
          {
            "Value": {
              "Fn::Join": [
                "",
                [
                  "UE1-MDM-LA01",
                  {
                    "Ref": "StackName"
                  }
                ]
              ]
            },
            "Key": "Name"
          },
          {
            "Value": "parttime_aim",
            "Key": "workload"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          },
          {
            "Value": "AIM",
            "Key": "Group"
          },
          {
            "Value": "Mike D.",
            "Key": "Owner"
          },
          {
            "Value": {
              "Fn::FindInMap": [
                {
                  "Ref": "StackName"
                },
                "Extras",
                "Tag"
              ]
            },
            "Key": "Env"
          },
          {
            "Value": "Talend",
            "Key": "Application"
          },
          {
            "Value": "Mdm",
            "Key": "Service"
          }
        ],
        "ImageId": "ami-6905f002",
        "KeyName": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "Key",
            "KeyName"
          ]
        },
        "InstanceType": "m3.xlarge",
        "NetworkInterfaces": [
          {
            "SubnetId": {
              "Ref": "TestAimTalendNet"
            },
            "DeviceIndex": "0",
            "GroupSet": [
              {
                "Ref": "MdmSecGrp"
              }
            ],
            "DeleteOnTermination": "true",
            "AssociatePublicIpAddress": "false"
          }
        ]
      }
    },
    "HdpNetAclInUdpHigh": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "102",
        "Protocol": "17",
        "PortRange": {
          "To": "65535",
          "From": "1024"
        },
        "Egress": "false",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "HdpNetAclOutNtp": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "102",
        "Protocol": "17",
        "PortRange": {
          "To": "123",
          "From": "123"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "0.0.0.0/0"
      }
    },
    "TestAimHdpRtNetAssociation": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "TestAimHdpNet"
        },
        "RouteTableId": "rtb-052f5f60"
      }
    },
    "UE1MDMLA01DNS": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "DNS",
            "Zone"
          ]
        },
        "TTL": "60",
        "Type": "A",
        "Name": {
          "Fn::Join": [
            ".",
            [
              {
                "Fn::Join": [
                  "",
                  [
                    "UE1-MDM-LA01",
                    {
                      "Ref": "StackName"
                    }
                  ]
                ]
              },
              {
                "Fn::FindInMap": [
                  {
                    "Ref": "StackName"
                  },
                  "DNS",
                  "Suffix"
                ]
              }
            ]
          ]
        },
        "ResourceRecords": [
          {
            "Fn::GetAtt": [
              "UE1MDMLA01",
              "PrivateIp"
            ]
          }
        ]
      }
    },
    "HdpNetAclOut445": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "110",
        "Protocol": "6",
        "PortRange": {
          "To": "445",
          "From": "445"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "HdpNetAclOutHttps": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "101",
        "Protocol": "6",
        "PortRange": {
          "To": "443",
          "From": "443"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "0.0.0.0/0"
      }
    },
    "UE1EDWLA01DNS": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "DNS",
            "Zone"
          ]
        },
        "TTL": "60",
        "Type": "A",
        "Name": {
          "Fn::Join": [
            ".",
            [
              {
                "Fn::Join": [
                  "",
                  [
                    "UE1-EDW-LA01",
                    {
                      "Ref": "StackName"
                    }
                  ]
                ]
              },
              {
                "Fn::FindInMap": [
                  {
                    "Ref": "StackName"
                  },
                  "DNS",
                  "Suffix"
                ]
              }
            ]
          ]
        },
        "ResourceRecords": [
          {
            "Fn::GetAtt": [
              "UE1EDWLA01",
              "PrivateIp"
            ]
          }
        ]
      }
    },
    "HdpNetAclOut139": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "109",
        "Protocol": "6",
        "PortRange": {
          "To": "139",
          "From": "139"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "HdpNetAclOutDns": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "107",
        "Protocol": "17",
        "PortRange": {
          "To": "53",
          "From": "53"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "HdpNetAclOutSsh": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "108",
        "Protocol": "6",
        "PortRange": {
          "To": "22",
          "From": "22"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.2.0.0/16"
      }
    },
    "HdpNetAclOut137": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "112",
        "Protocol": "17",
        "PortRange": {
          "To": "137",
          "From": "137"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "TestAimRSAclNetAssociation": {
      "Type": "AWS::EC2::SubnetNetworkAclAssociation",
      "Properties": {
        "SubnetId": {
          "Ref": "RSSubnet"
        },
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        }
      }
    },
    "TestAimHdpSecGrp": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "SecurityGroupIngress": [
          {
            "ToPort": "22",
            "FromPort": "22",
            "IpProtocol": "tcp",
            "CidrIp": "10.11.250.0/23"
          },
          {
            "ToPort": "22",
            "FromPort": "22",
            "IpProtocol": "tcp",
            "CidrIp": "10.101.16.0/21"
          },
          {
            "ToPort": "22",
            "FromPort": "22",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.0/24"
          },
          {
            "ToPort": "22",
            "FromPort": "22",
            "IpProtocol": "tcp",
            "CidrIp": "10.10.10.0/23"
          },
          {
            "ToPort": "65535",
            "FromPort": "1024",
            "IpProtocol": "tcp",
            "CidrIp": "10.2.0.0/16"
          },
          {
            "ToPort": "80",
            "FromPort": "80",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "7520",
            "FromPort": "7520",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "3306",
            "FromPort": "3306",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "10000",
            "FromPort": "10000",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "50010",
            "FromPort": "50010",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "50070",
            "FromPort": "50070",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.45/32"
          },
          {
            "ToPort": "8088",
            "FromPort": "8088",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.45/32"
          },
          {
            "ToPort": "11000",
            "FromPort": "11000",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.45/32"
          },
          {
            "ToPort": "15000",
            "FromPort": "15000",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.45/32"
          },
          {
            "ToPort": "8744",
            "FromPort": "8744",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.45/32"
          },
          {
            "ToPort": "19888",
            "FromPort": "19888",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.45/32"
          },
          {
            "ToPort": "8042",
            "FromPort": "8042",
            "IpProtocol": "tcp",
            "CidrIp": "10.35.35.45/32"
          },
          {
            "ToPort": "7000",
            "FromPort": "7000",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "7001",
            "FromPort": "7001",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "8000",
            "FromPort": "8000",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "8001",
            "FromPort": "8001",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "8020",
            "FromPort": "8020",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "8040",
            "FromPort": "8040",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "8080",
            "FromPort": "8080",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "8180",
            "FromPort": "8180",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "8888",
            "FromPort": "8888",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "8580",
            "FromPort": "8580",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          }
        ],
        "VpcId": "vpc-b7c9a9d2",
        "Tags": [
          {
            "Value": "TestAimHdpSecGrp",
            "Key": "Name"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          }
        ],
        "GroupDescription": "Test VPC AIM HDP and Talend Sec Grp",
        "SecurityGroupEgress": [
          {
            "ToPort": "80",
            "FromPort": "80",
            "IpProtocol": "tcp",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "ToPort": "123",
            "FromPort": "123",
            "IpProtocol": "udp",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "ToPort": "443",
            "FromPort": "443",
            "IpProtocol": "tcp",
            "CidrIp": "0.0.0.0/0"
          },
          {
            "ToPort": "88",
            "FromPort": "88",
            "IpProtocol": "udp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "88",
            "FromPort": "88",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "65535",
            "FromPort": "1024",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "65535",
            "FromPort": "1024",
            "IpProtocol": "udp",
            "CidrIp": "10.2.0.0/16"
          },
          {
            "ToPort": "22",
            "FromPort": "22",
            "IpProtocol": "tcp",
            "CidrIp": "10.2.0.0/16"
          },
          {
            "ToPort": "53",
            "FromPort": "53",
            "IpProtocol": "udp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "53",
            "FromPort": "53",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "65535",
            "FromPort": "1024",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "139",
            "FromPort": "139",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "445",
            "FromPort": "445",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "389",
            "FromPort": "389",
            "IpProtocol": "udp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "389",
            "FromPort": "389",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "137",
            "FromPort": "137",
            "IpProtocol": "udp",
            "CidrIp": "10.0.0.0/8"
          },
          {
            "ToPort": "25",
            "FromPort": "25",
            "IpProtocol": "tcp",
            "CidrIp": "10.0.0.0/8"
          }
        ]
      }
    },
    "HdpNetAclOut53Tcp": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "114",
        "Protocol": "6",
        "PortRange": {
          "To": "53",
          "From": "53"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "10.0.0.0/8"
      }
    },
    "HdpNetAclInNtp": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "103",
        "Protocol": "17",
        "PortRange": {
          "To": "123",
          "From": "123"
        },
        "Egress": "false",
        "RuleAction": "Allow",
        "CidrBlock": "0.0.0.0/0"
      }
    },
    "RSDns": {
      "Type": "AWS::Route53::RecordSet",
      "Properties": {
        "HostedZoneId": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "DNS",
            "Zone"
          ]
        },
        "TTL": "60",
        "Type": "CNAME",
        "Name": {
          "Fn::Join": [
            ".",
            [
              {
                "Fn::FindInMap": [
                  {
                    "Ref": "StackName"
                  },
                  "RS",
                  "DNS"
                ]
              },
              {
                "Ref": "StackName"
              },
              {
                "Fn::FindInMap": [
                  {
                    "Ref": "StackName"
                  },
                  "DNS",
                  "Suffix"
                ]
              }
            ]
          ]
        },
        "ResourceRecords": [
          {
            "Fn::Join": [
              "",
              [
                {
                  "Fn::GetAtt": [
                    "RSCluster",
                    "Endpoint.Address"
                  ]
                },
                "."
              ]
            ]
          }
        ]
      }
    },
    "UE1TALLA01": {
      "Type": "AWS::EC2::Instance",
      "Properties": {
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#cloud-config\nhostname: ",
                {
                  "Fn::Join": [
                    "",
                    [
                      "UE1-TAL-LA01",
                      {
                        "Ref": "StackName"
                      }
                    ]
                  ]
                },
                "\n",
                "fqdn: ",
                {
                  "Fn::Join": [
                    ".",
                    [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "UE1-TAL-LA01",
                            {
                              "Ref": "StackName"
                            }
                          ]
                        ]
                      },
                      {
                        "Fn::FindInMap": [
                          {
                            "Ref": "StackName"
                          },
                          "DNS",
                          "Suffix"
                        ]
                      }
                    ]
                  ]
                },
                "\n",
                "runcmd:\n",
                "- [ touch, /etc/aim_tal_app ]"
              ]
            ]
          }
        },
        "SourceDestCheck": "true",
        "Tags": [
          {
            "Value": {
              "Fn::Join": [
                "",
                [
                  "UE1-TAL-LA01",
                  {
                    "Ref": "StackName"
                  }
                ]
              ]
            },
            "Key": "Name"
          },
          {
            "Value": "parttime_aim",
            "Key": "workload"
          },
          {
            "Value": "AIM",
            "Key": "Billing"
          },
          {
            "Value": "AIM",
            "Key": "Group"
          },
          {
            "Value": "Mike D.",
            "Key": "Owner"
          },
          {
            "Value": {
              "Fn::FindInMap": [
                {
                  "Ref": "StackName"
                },
                "Extras",
                "Tag"
              ]
            },
            "Key": "Env"
          },
          {
            "Value": "Talend",
            "Key": "Application"
          },
          {
            "Value": "Tac",
            "Key": "Service"
          }
        ],
        "ImageId": "ami-6905f002",
        "KeyName": {
          "Fn::FindInMap": [
            {
              "Ref": "StackName"
            },
            "Key",
            "KeyName"
          ]
        },
        "InstanceType": "m3.xlarge",
        "NetworkInterfaces": [
          {
            "SubnetId": {
              "Ref": "TestAimTalendNet"
            },
            "DeviceIndex": "0",
            "GroupSet": [
              {
                "Ref": "TestAimHdpSecGrp"
              }
            ],
            "DeleteOnTermination": "true",
            "AssociatePublicIpAddress": "false"
          }
        ]
      }
    },
    "HdpNetAclOutHttp": {
      "Type": "AWS::EC2::NetworkAclEntry",
      "Properties": {
        "NetworkAclId": {
          "Ref": "AimHdpNetAcl"
        },
        "RuleNumber": "100",
        "Protocol": "6",
        "PortRange": {
          "To": "80",
          "From": "80"
        },
        "Egress": "true",
        "RuleAction": "Allow",
        "CidrBlock": "0.0.0.0/0"
      }
    },
    "RSNetGrp": {
      "Type": "AWS::Redshift::ClusterSubnetGroup",
      "Properties": {
        "SubnetIds": [
          {
            "Ref": "RSSubnet"
          }
        ],
        "Description": "AIM RS Subnet Group"
      }
    }
  },
  "Mappings": {
    "d2": {
      "DNS": {
        "Suffix": "accint.co",
        "Zone": "Z2IAX7BYTA3T14"
      },
      "RS": {
        "CIDR": "10.2.6.224/28",
        "DNS": "edw"
      },
      "Extras": {
        "Tag": "Dev"
      },
      "Key": {
        "KeyName": "aim-dev-key"
      },
      "TalendNet": {
        "CIDR": "10.2.6.192/28",
        "Name": "TestAimTalendNet"
      },
      "HdpNet": {
        "CIDR": "10.2.6.208/28",
        "Name": "TestHdpNet"
      }
    },
    "t0": {
      "DNS": {
        "Suffix": "accint.co",
        "Zone": "Z2IAX7BYTA3T14"
      },
      "RS": {
        "CIDR": "10.2.2.96/28",
        "DNS": "edw"
      },
      "Extras": {
        "Tag": "Test"
      },
      "Key": {
        "KeyName": "aim-test-key"
      },
      "TalendNet": {
        "CIDR": "10.2.1.80/28",
        "Name": "TestAimTalendNet"
      },
      "HdpNet": {
        "CIDR": "10.2.1.96/27",
        "Name": "TestHdpNet"
      }
    },
    "d0": {
      "DNS": {
        "Suffix": "accint.co",
        "Zone": "Z2IAX7BYTA3T14"
      },
      "RS": {
        "CIDR": "10.2.7.160/28",
        "DNS": "edw"
      },
      "Extras": {
        "Tag": "Dev"
      },
      "Key": {
        "KeyName": "aim-dev-key"
      },
      "TalendNet": {
        "CIDR": "10.2.7.128/28",
        "Name": "TestAimTalendNet"
      },
      "HdpNet": {
        "CIDR": "10.2.7.144/28",
        "Name": "TestHdpNet"
      }
    },
    "d1": {
      "DNS": {
        "Suffix": "accint.co",
        "Zone": "Z2IAX7BYTA3T14"
      },
      "RS": {
        "CIDR": "10.2.2.112/28",
        "DNS": "edw"
      },
      "Extras": {
        "Tag": "Dev"
      },
      "Key": {
        "KeyName": "aim-dev-key"
      },
      "TalendNet": {
        "CIDR": "10.2.1.160/28",
        "Name": "TestAimTalendNet"
      },
      "HdpNet": {
        "CIDR": "10.2.1.128/27",
        "Name": "TestHdpNet"
      }
    }
  },
  "Parameters": {
    "RSPassword": {
      "Type": "String",
      "NoEcho": true,
      "Description": "The password associated with the master user account for the redshift cluster that is being created."
    },
    "StackName": {
      "AllowedPattern": "[-a-z0-9]*",
      "Default": "d1",
      "Type": "String",
      "ConstraintDescription": "can contain only alphanumeric characters and dashes",
      "Description": "Stack Name"
    }
  }
}
